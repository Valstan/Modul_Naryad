–ö–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞:
conftest.py
main.py
print_proekt.py
db\backup.py
db\database.py
gui\dialogs.py
gui\employees_form.py
gui\main_window.py
gui\work_order_form.py
reports\excel_report.py
reports\html_report.py
reports\pdf_report.py
tests\test_database.py
utils\validators.py

--------------------------------------------------------------------------------

–ü—É—Ç—å: conftest.py
–ò–º—è —Ñ–∞–π–ª–∞: conftest.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# conftest.py (–≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞)
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å –ø–æ–∏—Å–∫–∞ –º–æ–¥—É–ª–µ–π
root_dir = Path(__file__).parent
sys.path.append(str(root_dir))
--------------------------------------------------------------------------------
–ü—É—Ç—å: main.py
–ò–º—è —Ñ–∞–π–ª–∞: main.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# main.py
import customtkinter as ctk
from db.database import Database
from db.backup import BackupManager
from gui.main_window import MainWindow
from gui.dialogs import show_error


def main() -> None:
    """–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É."""
    try:
        # –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
        BackupManager("work_orders.db").create_backup()

        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GUI
        app = MainWindow()
        app.mainloop()

    except Exception as e:
        show_error(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {str(e)}")


if __name__ == "__main__":
    main()
--------------------------------------------------------------------------------
–ü—É—Ç—å: print_proekt.py
–ò–º—è —Ñ–∞–π–ª–∞: print_proekt.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
import os

def create_project_map(project_root):
    project_map = []
    for root, dirs, files in os.walk(project_root):
        if '.venv' in dirs:
            dirs.remove('.venv')  # –ò—Å–∫–ª—é—á–∞–µ–º –ø–∞–ø–∫—É .venv –∏–∑ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
        for file in files:
            if file.endswith('.py'):
                file_path = os.path.join(root, file)
                project_map.append(os.path.relpath(file_path, project_root))
    return project_map

project_root = os.getcwd()  # –ö–æ—Ä–Ω–µ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞
output_file = os.path.join(project_root, "project_contents.txt")

# –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É –ø—Ä–æ–µ–∫—Ç–∞
project_map = create_project_map(project_root)

with open(output_file, 'w', encoding='utf-8') as f:
    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–∞—Ä—Ç—É –ø—Ä–æ–µ–∫—Ç–∞
    f.write("–ö–∞—Ä—Ç–∞ –ø—Ä–æ–µ–∫—Ç–∞:\n")
    for file_path in project_map:
        f.write(f"{file_path}\n")
    f.write('\n' + '-' * 80 + '\n\n')

    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤
    for file_path in project_map:
        full_path = os.path.join(project_root, file_path)
        with open(full_path, 'r', encoding='utf-8') as src_file:
            content = src_file.read()

        f.write(f"–ü—É—Ç—å: {file_path}\n")
        f.write(f"–ò–º—è —Ñ–∞–π–ª–∞: {os.path.basename(file_path)}\n")
        f.write("–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:\n")
        f.write(content)
        f.write('\n' + '-' * 80 + '\n')

print(f"–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –≤ —Ñ–∞–π–ª: {output_file}")
--------------------------------------------------------------------------------
–ü—É—Ç—å: db\backup.py
–ò–º—è —Ñ–∞–π–ª–∞: backup.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# db/backup.py
import os
import shutil
from pathlib import Path
from datetime import datetime
from typing import Optional


class BackupManager:
    """–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω—ã–º–∏ –∫–æ–ø–∏—è–º–∏ –ë–î —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞."""

    def __init__(self, db_path: str, backup_dir: str = "backups", max_backups: int = 20):
        self.db_path = Path(db_path)
        self.backup_dir = Path(backup_dir)
        self.max_backups = max_backups

        if not self.db_path.exists():
            raise FileNotFoundError(f"–§–∞–π–ª –ë–î {db_path} –Ω–µ –Ω–∞–π–¥–µ–Ω!")

        self._ensure_backup_dir()

    def _ensure_backup_dir(self) -> None:
        """–°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π."""
        self.backup_dir.mkdir(exist_ok=True, parents=True)

    def create_backup(self) -> Optional[str]:
        """–°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫."""
        try:
            # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            backup_path = self.backup_dir / f"backup_{timestamp}.db"

            # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
            shutil.copy2(str(self.db_path), str(backup_path))
            self._cleanup_old_backups()
            return str(backup_path)

        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è: {str(e)}")
            return None

    def _cleanup_old_backups(self) -> None:
        """–£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –∫–æ–ø–∏–π, –µ—Å–ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç."""
        backups = sorted(
            self.backup_dir.glob("backup_*.db"),
            key=lambda x: x.stat().st_mtime,
            reverse=False
        )

        while len(backups) > self.max_backups:
            old_backup = backups.pop(0)
            os.remove(str(old_backup))
--------------------------------------------------------------------------------
–ü—É—Ç—å: db\database.py
–ò–º—è —Ñ–∞–π–ª–∞: database.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# db/database.py
import sqlite3
from pathlib import Path
from typing import Optional, List, Tuple

class Database:
    _instance = None

    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
            cls._instance._init_db()
        return cls._instance

    def _init_db(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ñ–∞–π–ª–∞."""
        self.db_path = Path("work_orders.db")
        self.db_path.touch(exist_ok=True)  # –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
        self.conn = sqlite3.connect(str(self.db_path))
        self.cursor = self.conn.cursor()
        self._create_tables()

    def _create_tables(self) -> None:
        """–°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏–∑ SQL-—Ñ–∞–π–ª–∞."""
        sql_file = Path(__file__).parent / "queries.sql"
        if sql_file.exists():
            with open(sql_file, "r") as f:
                sql = f.read()
            self.cursor.executescript(sql)
            self.conn.commit()

    def execute_query(self, query: str, params: Optional[Tuple] = None) -> List[Tuple]:
        """–ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ SQL-–∑–∞–ø—Ä–æ—Å–∞."""
        if params:
            self.cursor.execute(query, params)
        else:
            self.cursor.execute(query)
        self.conn.commit()
        return self.cursor.fetchall()

    def __del__(self) -> None:
        """–ó–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–∞."""
        self.conn.close()
--------------------------------------------------------------------------------
–ü—É—Ç—å: gui\dialogs.py
–ò–º—è —Ñ–∞–π–ª–∞: dialogs.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# gui/dialogs.py
import customtkinter as ctk
from tkcalendar import Calendar
from datetime import datetime
from typing import List, Optional, Tuple
from db.database import Database


class DatePickerDialog(ctk.CTkToplevel):
    """–î–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã."""

    def __init__(self, parent: ctk.CTkFrame) -> None:
        super().__init__(parent)
        self.title("–í—ã–±–æ—Ä –¥–∞—Ç—ã")
        self.geometry("300x200")
        self.resizable(False, False)
        self._selected_date: Optional[datetime] = None

        # –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏–∑ tkcalendar
        self.calendar = Calendar(self, selectmode="day", date_pattern="dd.mm.yyyy")
        self.calendar.pack(pady=10)

        # –ö–Ω–æ–ø–∫–∏
        self.btn_frame = ctk.CTkFrame(self)
        self.btn_frame.pack(pady=10)

        self.ok_btn = ctk.CTkButton(self.btn_frame, text="OK", command=self._on_ok)
        self.ok_btn.pack(side="left", padx=5)

        self.cancel_btn = ctk.CTkButton(self.btn_frame, text="–û—Ç–º–µ–Ω–∞", command=self.destroy)
        self.cancel_btn.pack(side="right", padx=5)

    def _on_ok(self) -> None:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã."""
        try:
            self._selected_date = datetime.strptime(self.calendar.get_date(), "%d.%m.%Y")
            self.destroy()
        except ValueError:
            self._selected_date = None

    def get_date(self) -> Optional[datetime]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É."""
        return self._selected_date


class WorkerSelectionDialog(ctk.CTkToplevel):
    """–î–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Ä–∞–±–æ—á–∏—Ö."""

    def __init__(self, parent: ctk.CTkFrame, db: Database) -> None:
        super().__init__(parent)
        self.title("–í—ã–±–æ—Ä —Ä–∞–±–æ—á–∏—Ö")
        self.geometry("600x400")
        self.db = db
        self._selected_ids: List[int] = []
        self._setup_ui()

    def _setup_ui(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."""
        # –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
        self.tree = ttk.Treeview(self, columns=("id", "name", "workshop"), show="headings")
        self.tree.heading("id", text="–¢–∞–±–µ–ª—å–Ω—ã–π ‚Ññ")
        self.tree.heading("name", text="–§–ò–û")
        self.tree.heading("workshop", text="–¶–µ—Ö")
        self.tree.pack(expand=True, fill="both", padx=10, pady=10)

        # –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
        workers = self.db.execute_query("SELECT employee_id, full_name, workshop_number FROM employees")
        for worker in workers:
            self.tree.insert("", "end", values=worker)

        # –ö–Ω–æ–ø–∫–∏
        self.btn_frame = ctk.CTkFrame(self)
        self.btn_frame.pack(pady=10)

        self.select_btn = ctk.CTkButton(self.btn_frame, text="–í—ã–±—Ä–∞—Ç—å", command=self._on_select)
        self.select_btn.pack(side="left", padx=5)

        self.cancel_btn = ctk.CTkButton(self.btn_frame, text="–û—Ç–º–µ–Ω–∞", command=self.destroy)
        self.cancel_btn.pack(side="right", padx=5)

    def _on_select(self) -> None:
        """–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—á–∏—Ö."""
        selected_items = self.tree.selection()
        self._selected_ids = [int(self.tree.item(item)["values"][0]) for item in selected_items]
        self.destroy()

    def get_selected_workers(self) -> List[int]:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ ID –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—á–∏—Ö."""
        return self._selected_ids


def show_error(message: str) -> None:
    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –æ–∫–Ω–æ —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ."""
    dialog = ctk.CTkToplevel()
    dialog.title("–û—à–∏–±–∫–∞")
    dialog.geometry("400x100")

    label = ctk.CTkLabel(dialog, text=message, text_color="red")
    label.pack(pady=20)

    btn = ctk.CTkButton(dialog, text="OK", command=dialog.destroy)
    btn.pack(pady=5)


def show_info(message: str) -> None:
    """–û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ."""
    dialog = ctk.CTkToplevel()
    dialog.title("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è")
    dialog.geometry("400x100")

    label = ctk.CTkLabel(dialog, text=message)
    label.pack(pady=20)

    btn = ctk.CTkButton(dialog, text="OK", command=dialog.destroy)
    btn.pack(pady=5)
--------------------------------------------------------------------------------
–ü—É—Ç—å: gui\employees_form.py
–ò–º—è —Ñ–∞–π–ª–∞: employees_form.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# gui/employees_form.py
import customtkinter as ctk
from tkinter import ttk
from db.database import Database
from gui.dialogs import show_error, show_info
from utils.validators import validate_unique_employee_id
from typing import Optional, List


class EmployeesForm(ctk.CTkFrame):
    """–§–æ—Ä–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤."""

    def __init__(self, parent: ctk.CTkFrame, db: Database) -> None:
        super().__init__(parent)
        self.db = db
        self._setup_ui()
        self._load_employees()

    def _setup_ui(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."""
        self.pack(expand=True, fill="both", padx=20, pady=20)

        # –¢–∞–±–ª–∏—Ü–∞ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤
        self.tree = ttk.Treeview(
            self,
            columns=("employee_id", "full_name", "workshop", "position"),
            show="headings"
        )
        self.tree.heading("employee_id", text="–¢–∞–±–µ–ª—å–Ω—ã–π ‚Ññ")
        self.tree.heading("full_name", text="–§–ò–û")
        self.tree.heading("workshop", text="–¶–µ—Ö")
        self.tree.heading("position", text="–î–æ–ª–∂–Ω–æ—Å—Ç—å")
        self.tree.pack(expand=True, fill="both")

        # –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        btn_frame = ctk.CTkFrame(self)
        btn_frame.pack(pady=10)

        ctk.CTkButton(btn_frame, text="–î–æ–±–∞–≤–∏—Ç—å", command=self._open_add_dialog).pack(side="left", padx=5)
        ctk.CTkButton(btn_frame, text="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", command=self._open_edit_dialog).pack(side="left", padx=5)
        ctk.CTkButton(btn_frame, text="–£–¥–∞–ª–∏—Ç—å", command=self._delete_employee).pack(side="left", padx=5)

    def _load_employees(self) -> None:
        """–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –∏–∑ –ë–î."""
        for row in self.tree.get_children():
            self.tree.delete(row)

        employees = self.db.execute_query("SELECT * FROM employees")
        for emp in employees:
            self.tree.insert("", "end", values=emp)

    def _open_add_dialog(self) -> None:
        """–û—Ç–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞."""
        dialog = EmployeeDialog(self, self.db)
        if dialog.result:
            self._load_employees()

    def _open_edit_dialog(self) -> None:
        """–û—Ç–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞."""
        selected = self.tree.selection()
        if not selected:
            show_error("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!")
            return

        # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ç–∞–±–ª–∏—Ü—ã —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —Ç–∏–ø–∞
        item_data = self.tree.item(selected[0])
        values = item_data.get("values", [])

        # –Ø–≤–Ω–æ–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –∫ —Ç–∏–ø—É List[str] –∏–ª–∏ None
        employee_data: Optional[List[str]] = values if isinstance(values, list) else None

        if not employee_data:
            show_error("–î–∞–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã")
            return

        dialog = EmployeeDialog(self, self.db, employee_data)
        if dialog.result:
            self._load_employees()

    def _delete_employee(self) -> None:
        """–£–¥–∞–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞."""
        selected = self.tree.selection()
        if not selected:
            show_error("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è!")
            return

        employee_id = self.tree.item(selected[0])["values"][0]
        self.db.execute_query("DELETE FROM employees WHERE id = ?", (employee_id,))
        self._load_employees()


class EmployeeDialog(ctk.CTkToplevel):
    """–î–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–∞."""

    def __init__(self, parent: ctk.CTkFrame, db: Database, data: Optional[List] = None):
        super().__init__(parent)
        self.db = db
        self.result = False
        self.title("–î–∞–Ω–Ω—ã–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞" if not data else "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞")
        self.geometry("400x300")

        # –ü–æ–ª—è –≤–≤–æ–¥–∞
        self.employee_id = ctk.CTkEntry(self, placeholder_text="–¢–∞–±–µ–ª—å–Ω—ã–π ‚Ññ")
        self.full_name = ctk.CTkEntry(self, placeholder_text="–§–ò–û")
        self.workshop = ctk.CTkEntry(self, placeholder_text="–¶–µ—Ö")
        self.position = ctk.CTkEntry(self, placeholder_text="–î–æ–ª–∂–Ω–æ—Å—Ç—å")

        # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –µ—Å–ª–∏ —ç—Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        if data:
            self.employee_id.insert(0, str(data[1]))  # data[1] = employee_id –≤ —Ç–∞–±–ª–∏—Ü–µ
            self.full_name.insert(0, data[2])
            self.workshop.insert(0, str(data[3]))
            self.position.insert(0, data[4])

        # –†–∞–∑–º–µ—â–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        self.employee_id.pack(pady=5)
        self.full_name.pack(pady=5)
        self.workshop.pack(pady=5)
        self.position.pack(pady=5)

        # –ö–Ω–æ–ø–∫–∏
        btn_frame = ctk.CTkFrame(self)
        btn_frame.pack(pady=10)

        ctk.CTkButton(btn_frame, text="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å", command=self._save).pack(side="left", padx=5)
        ctk.CTkButton(btn_frame, text="–û—Ç–º–µ–Ω–∞", command=self.destroy).pack(side="right", padx=5)

    def _save(self) -> None:
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç–Ω–∏–∫–∞."""
        employee_id = self.employee_id.get().strip()
        full_name = self.full_name.get().strip()
        workshop = self.workshop.get().strip()
        position = self.position.get().strip()

        # –í–∞–ª–∏–¥–∞—Ü–∏—è
        if not all([employee_id, full_name, workshop, position]):
            show_error("–í—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è!")
            return

        if not validate_unique_employee_id(employee_id, self.db):
            show_error("–¢–∞–±–µ–ª—å–Ω—ã–π –Ω–æ–º–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º!")
            return

        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
        query = """
            INSERT INTO employees (employee_id, full_name, workshop_number, position)
            VALUES (?, ?, ?, ?)
            ON CONFLICT(employee_id) DO UPDATE SET
                full_name = excluded.full_name,
                workshop_number = excluded.workshop_number,
                position = excluded.position
        """
        self.db.execute_query(query, (employee_id, full_name, workshop, position))
        self.result = True
        self.destroy()
--------------------------------------------------------------------------------
–ü—É—Ç—å: gui\main_window.py
–ò–º—è —Ñ–∞–π–ª–∞: main_window.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# gui/main_window.py
from typing import Dict

import customtkinter as ctk

from db.database import Database
from gui.dialogs import show_error, show_info
from gui.employees_form import EmployeesForm
from gui.work_order_form import WorkOrderForm
from reports.excel_report import ExcelReportGenerator


class MainWindow(ctk.CTk):
    """–ì–ª–∞–≤–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏."""

    def __init__(self) -> None:
        super().__init__()
        self.title("–£—á–µ—Ç —Å–¥–µ–ª—å–Ω—ã—Ö —Ä–∞–±–æ—Ç")
        self.geometry("1200x800")

        # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
        self.db: Database = Database()
        self._load_filters_data()

        # –°—Ç–∏–ª—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        ctk.set_appearance_mode("light")
        ctk.set_default_color_theme("green")

        # –°–æ–∑–¥–∞–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
        self.tabview = ctk.CTkTabview(self)
        self.tabview.add("–ù–∞—Ä—è–¥—ã")
        self.tabview.add("–†–∞–±–æ—Ç–Ω–∏–∫–∏")
        self.tabview.add("–û—Ç—á–µ—Ç—ã")
        self.tabview.pack(expand=True, fill="both", padx=20, pady=20)

        # –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –≤–∫–ª–∞–¥–æ–∫
        self._init_work_orders_tab()
        self._init_employees_tab()
        self._init_reports_tab()

    def _load_filters_data(self) -> None:
        """–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ –æ—Ç—á–µ—Ç–æ–≤."""
        self.contracts = self.db.execute_query("SELECT contract_code FROM contracts")
        self.products = self.db.execute_query("SELECT name FROM products")

    def _init_work_orders_tab(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏ '–ù–∞—Ä—è–¥—ã'."""
        tab = self.tabview.tab("–ù–∞—Ä—è–¥—ã")
        WorkOrderForm(tab, self.db)

    def _init_employees_tab(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏ '–†–∞–±–æ—Ç–Ω–∏–∫–∏'."""
        tab = self.tabview.tab("–†–∞–±–æ—Ç–Ω–∏–∫–∏")
        EmployeesForm(tab, self.db)

    def _init_reports_tab(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏ '–û—Ç—á–µ—Ç—ã'."""
        tab = self.tabview.tab("–û—Ç—á–µ—Ç—ã")

        # –§—Ä–µ–π–º –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        filters_frame = ctk.CTkFrame(tab)
        filters_frame.pack(side="left", fill="y", padx=10, pady=10)

        # –ü–æ–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
        ctk.CTkLabel(filters_frame, text="–§–∏–ª—å—Ç—Ä—ã –æ—Ç—á–µ—Ç–æ–≤", font=("Arial", 14)).pack(pady=5)

        # –î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞
        self.start_date_entry = ctk.CTkEntry(filters_frame, placeholder_text="–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ (–î–î.–ú–ú.–ì–ì–ì–ì)")
        self.start_date_entry.pack(pady=5)

        # –î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è
        self.end_date_entry = ctk.CTkEntry(filters_frame, placeholder_text="–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è (–î–î.–ú–ú.–ì–ì–ì–ì)")
        self.end_date_entry.pack(pady=5)

        # –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã
        self.contract_combobox = ctk.CTkComboBox(
            filters_frame,
            values=[c[0] for c in self.contracts],
            placeholder_text="–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç"
        )
        self.contract_combobox.pack(pady=5)

        # –ò–∑–¥–µ–ª–∏—è
        self.product_combobox = ctk.CTkComboBox(
            filters_frame,
            values=[p[0] for p in self.products],
            placeholder_text="–í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–¥–µ–ª–∏–µ"
        )
        self.product_combobox.pack(pady=5)

        # –§—Ä–µ–π–º –¥–ª—è –∫–Ω–æ–ø–æ–∫ —ç–∫—Å–ø–æ—Ä—Ç–∞
        export_frame = ctk.CTkFrame(tab)
        export_frame.pack(side="right", fill="both", expand=True, padx=10, pady=10)

        ctk.CTkLabel(export_frame, text="–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–æ–≤", font=("Arial", 14)).pack(pady=10)

        # –ö–Ω–æ–ø–∫–∏
        ctk.CTkButton(export_frame, text="Excel", command=self._export_excel).pack(pady=5, fill="x")
        ctk.CTkButton(export_frame, text="PDF", command=self._export_pdf).pack(pady=5, fill="x")
        ctk.CTkButton(export_frame, text="HTML", command=self._export_html).pack(pady=5, fill="x")

    def _get_filters(self) -> Dict:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏."""
        return {
            "start_date": self.start_date_entry.get(),
            "end_date": self.end_date_entry.get(),
            "contract_code": self.contract_combobox.get(),
            "product": self.product_combobox.get()
        }

    def _export_excel(self) -> None:
        """–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞ –≤ Excel."""
        try:
            generator = ExcelReportGenerator(self.db)
            path = generator.generate(self._get_filters())
            show_info(f"Excel-–æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω:\n{path}")
        except Exception as e:
            show_error(f"–û—à–∏–±–∫–∞: {str(e)}")

    def _export_pdf(self) -> None:
        """–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞ –≤ PDF."""
        try:
            from reports.pdf_report import PDFReportGenerator
            generator = PDFReportGenerator(self.db)
            path = generator.generate(self._get_filters())
            if path.startswith("–û—à–∏–±–∫–∞"):
                show_error(path)
            else:
                show_info(f"PDF-–æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω:\n{path}")
        except Exception as e:
            show_error(f"–û—à–∏–±–∫–∞: {str(e)}")

    def _export_html(self) -> None:
        """–≠–∫—Å–ø–æ—Ä—Ç –æ—Ç—á–µ—Ç–∞ –≤ HTML."""
        try:
            from reports.html_report import HTMLReportGenerator
            generator = HTMLReportGenerator(self.db)
            path = generator.generate(self._get_filters())
            if path.startswith("–û—à–∏–±–∫–∞"):
                show_error(path)
            else:
                show_info(f"HTML-–æ—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω:\n{path}")
        except Exception as e:
            show_error(f"–û—à–∏–±–∫–∞: {str(e)}")


if __name__ == "__main__":
    try:
        app = MainWindow()
        app.mainloop()
    except Exception as e:
        show_error(f"–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞: {str(e)}")
--------------------------------------------------------------------------------
–ü—É—Ç—å: gui\work_order_form.py
–ò–º—è —Ñ–∞–π–ª–∞: work_order_form.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# gui/work_order_form.py
from datetime import datetime
from tkinter import ttk
from typing import List, Dict

import customtkinter as ctk

from db.database import Database
from gui.dialogs import DatePickerDialog, WorkerSelectionDialog, show_error
from utils.validators import validate_order_data


class WorkOrderForm(ctk.CTkFrame):
    """–§–æ—Ä–º–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞—Ä—è–¥–æ–≤ —Ä–∞–±–æ—Ç."""

    def __init__(self, parent: ctk.CTkFrame, db: Database) -> None:
        super().__init__(parent)
        self.db = db
        self._current_workers: List[int] = []
        self._current_works: List[Dict] = []
        self._setup_ui()
        self._load_initial_data()

    def _setup_ui(self) -> None:
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞."""
        self.pack(expand=True, fill="both", padx=20, pady=20)

        # –ü–æ–ª—è –≤–≤–æ–¥–∞
        self.order_id_label = ctk.CTkLabel(self, text="–ù–∞—Ä—è–¥ ‚Ññ:")
        self.order_id_label.grid(row=0, column=0, sticky="w")
        self.order_id_value = ctk.CTkLabel(self, text="–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏")
        self.order_id_value.grid(row=0, column=1, sticky="w")

        # –î–∞—Ç–∞ –Ω–∞—Ä—è–¥–∞
        self.date_label = ctk.CTkLabel(self, text="–î–∞—Ç–∞:")
        self.date_label.grid(row=1, column=0, sticky="w")
        self.date_entry = ctk.CTkEntry(self)
        self.date_entry.insert(0, datetime.now().strftime("%d.%m.%Y"))
        self.date_entry.grid(row=1, column=1, sticky="ew")
        self.date_picker_btn = ctk.CTkButton(self, text="üìÖ", width=30, command=self._open_date_picker)
        self.date_picker_btn.grid(row=1, column=2, padx=5)

        # –í—ã–±–æ—Ä —Ä–∞–±–æ—á–∏—Ö
        self.workers_btn = ctk.CTkButton(self, text="–í—ã–±—Ä–∞—Ç—å —Ä–∞–±–æ—á–∏—Ö", command=self._select_workers)
        self.workers_btn.grid(row=2, column=0, columnspan=3, pady=10, sticky="ew")

        # –¢–∞–±–ª–∏—Ü–∞ –≤–∏–¥–æ–≤ —Ä–∞–±–æ—Ç
        self.works_table = ttk.Treeview(self, columns=("work_type", "quantity", "amount"), show="headings")
        self.works_table.heading("work_type", text="–í–∏–¥ —Ä–∞–±–æ—Ç—ã")
        self.works_table.heading("quantity", text="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ")
        self.works_table.heading("amount", text="–°—É–º–º–∞")
        self.works_table.grid(row=3, column=0, columnspan=3, sticky="nsew")

        # –ö–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç
        self.add_work_btn = ctk.CTkButton(self, text="+ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞–±–æ—Ç—É", command=self._add_work)
        self.add_work_btn.grid(row=4, column=0, pady=10)
        self.remove_work_btn = ctk.CTkButton(self, text="- –£–¥–∞–ª–∏—Ç—å —Ä–∞–±–æ—Ç—É", command=self._remove_work)
        self.remove_work_btn.grid(row=4, column=1, pady=10)

        # –ò—Ç–æ–≥–æ–≤–∞—è —Å—É–º–º–∞
        self.total_label = ctk.CTkLabel(self, text="–ò—Ç–æ–≥–æ:")
        self.total_label.grid(row=5, column=0, sticky="w")
        self.total_value = ctk.CTkLabel(self, text="0.00 ‚ÇΩ")
        self.total_value.grid(row=5, column=1, sticky="w")

        # –ö–Ω–æ–ø–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        self.save_btn = ctk.CTkButton(self, text="–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Ä—è–¥", command=self._save_order)
        self.save_btn.grid(row=6, column=0, columnspan=3, pady=20, sticky="ew")

    def _load_initial_data(self) -> None:
        """–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–ø–∏—Å–∫–æ–≤."""
        self.products = self.db.execute_query("SELECT id, name FROM products")
        self.contracts = self.db.execute_query("SELECT id, contract_code FROM contracts")

    def _open_date_picker(self) -> None:
        """–û—Ç–∫—Ä—ã—Ç–∏–µ –¥–∏–∞–ª–æ–≥–∞ –≤—ã–±–æ—Ä–∞ –¥–∞—Ç—ã."""
        dialog = DatePickerDialog(self)
        date = dialog.get_date()
        if date:
            self.date_entry.delete(0, "end")
            self.date_entry.insert(0, date.strftime("%d.%m.%Y"))

    def _select_workers(self) -> None:
        """–í—ã–±–æ—Ä —Ä–∞–±–æ—á–∏—Ö –∏–∑ —Å–ø–∏—Å–∫–∞."""
        dialog = WorkerSelectionDialog(self, self.db)
        workers = dialog.get_selected_workers()
        if workers:
            self._current_workers = workers
            self.workers_btn.configure(text=f"–í—ã–±—Ä–∞–Ω–æ: {len(workers)} —Ä–∞–±–æ—á–∏—Ö")

    def _add_work(self) -> None:
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∞ —Ä–∞–±–æ—Ç—ã –≤ —Ç–∞–±–ª–∏—Ü—É."""
        # –ó–∞–≥–ª—É—à–∫–∞: –∑–¥–µ—Å—å –±—É–¥–µ—Ç –¥–∏–∞–ª–æ–≥ –≤—ã–±–æ—Ä–∞ —Ä–∞–±–æ—Ç—ã
        work_type = ("–ú–æ–Ω—Ç–∞–∂ –ø—Ä–æ–≤–æ–¥–∫–∏", 150.0)  # –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
        self._current_works.append({"type_id": 1, "quantity": 5, "price": work_type[1]})
        self._update_works_table()

    def _update_works_table(self) -> None:
        """–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ä–∞–±–æ—Ç."""
        for row in self.works_table.get_children():
            self.works_table.delete(row)

        total = 0.0
        for work in self._current_works:
            amount = work["quantity"] * work["price"]
            self.works_table.insert("", "end", values=(work["type_id"], work["quantity"], f"{amount:.2f} ‚ÇΩ"))
            total += amount

        self.total_value.configure(text=f"{total:.2f} ‚ÇΩ")

    def _save_order(self) -> None:
        is_valid, error_msg = validate_order_data(
            self.date_entry.get(),
            self._current_workers,
            self._current_works,
            self.db
        )

        if not is_valid:
            show_error(error_msg)
            return

# –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –æ–∫–æ–Ω –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
--------------------------------------------------------------------------------
–ü—É—Ç—å: reports\excel_report.py
–ò–º—è —Ñ–∞–π–ª–∞: excel_report.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# reports/excel_report.py
import pandas as pd
from db.database import Database
from pathlib import Path
from typing import Optional, Dict, List
from datetime import datetime


class ExcelReportGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á–µ—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ Excel."""

    def __init__(self, db: Database) -> None:
        self.db = db
        self._output_dir = Path("reports/excel")
        self._output_dir.mkdir(exist_ok=True, parents=True)

    def generate(
            self,
            filters: Optional[Dict] = None,
            filename: Optional[str] = None
    ) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç—á–µ—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö."""
        query = """
            SELECT 
                wo.id AS order_id,
                wo.order_date,
                p.name AS product,
                c.contract_code,
                SUM(owt.amount) AS total_amount,
                GROUP_CONCAT(e.full_name, ', ') AS workers
            FROM work_orders wo
            LEFT JOIN products p ON wo.product_id = p.id
            LEFT JOIN contracts c ON wo.contract_id = c.id
            LEFT JOIN order_workers ow ON wo.id = ow.order_id
            LEFT JOIN employees e ON ow.worker_id = e.id
            LEFT JOIN order_work_types owt ON wo.id = owt.order_id
            GROUP BY wo.id
        """
        data = self.db.execute_query(query)

        # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –≤ DataFrame
        df = pd.DataFrame(
            data,
            columns=["order_id", "order_date", "product", "contract_code", "total_amount", "workers"]
        )

        # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤
        if filters:
            df = self._apply_filters(df, filters)

        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
        if not filename:
            timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
            filename = f"report_{timestamp}.xlsx"

        # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Excel
        output_path = self._output_dir / filename
        df.to_excel(output_path, index=False)
        return str(output_path)

    def _apply_filters(self, df: pd.DataFrame, filters: Dict) -> pd.DataFrame:
        """–ü—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã –∫ –¥–∞–Ω–Ω—ã–º."""
        if "start_date" in filters:
            df = df[df["order_date"] >= filters["start_date"]]
        if "contract_code" in filters:
            df = df[df["contract_code"] == filters["contract_code"]]
        # –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏
        return df
--------------------------------------------------------------------------------
–ü—É—Ç—å: reports\html_report.py
–ò–º—è —Ñ–∞–π–ª–∞: html_report.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# reports/html_report.py
from db.database import Database
from pathlib import Path
from datetime import datetime
from typing import Optional, Dict

class HTMLReportGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á–µ—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ HTML."""

    def __init__(self, db: Database) -> None:
        self.db = db
        self._output_dir = Path("reports/html")
        self._output_dir.mkdir(exist_ok=True, parents=True)

    def generate(self, filters: Optional[Dict] = None, filename: Optional[str] = None) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML-–æ—Ç—á–µ—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö."""
        try:
            data = self._fetch_data(filters)
            if not data:
                return "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á–µ—Ç–∞."

            # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ HTML-—Ç–∞–±–ª–∏—Ü—ã
            html_content = [
                "<!DOCTYPE html>",
                "<html>",
                "<head>",
                "<title>–û—Ç—á–µ—Ç –ø–æ –Ω–∞—Ä—è–¥–∞–º</title>",
                "<style>",
                "table { border-collapse: collapse; width: 100%; }",
                "th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }",
                "th { background-color: #f2f2f2; }",
                "</style>",
                "</head>",
                "<body>",
                "<h1>–û—Ç—á–µ—Ç –ø–æ –Ω–∞—Ä—è–¥–∞–º —Ä–∞–±–æ—Ç</h1>",
                "<table>",
                "<tr><th>–ù–∞—Ä—è–¥ ‚Ññ</th><th>–î–∞—Ç–∞</th><th>–ò–∑–¥–µ–ª–∏–µ</th><th>–ö–æ–Ω—Ç—Ä–∞–∫—Ç</th><th>–°—É–º–º–∞</th></tr>"
            ]

            for row in data:
                html_content.append(f"<tr><td>{row[0]}</td><td>{row[1]}</td><td>{row[2]}</td><td>{row[3]}</td><td>{row[4]}</td></tr>")

            html_content.extend(["</table>", "</body>", "</html>"])

            # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
            if not filename:
                timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
                filename = f"report_{timestamp}.html"

            output_path = self._output_dir / filename
            with open(output_path, "w", encoding="utf-8") as f:
                f.write("\n".join(html_content))

            return str(output_path)

        except Exception as e:
            return f"–û—à–∏–±–∫–∞: {str(e)}"

    def _fetch_data(self, filters: Optional[Dict]) -> list:
        """–ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î —Å —É—á–µ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤."""
        query = """  
            SELECT  
                wo.id AS order_id,  
                wo.order_date,  
                p.name AS product,  
                c.contract_code,  
                SUM(owt.amount) AS total_amount  
            FROM work_orders wo  
            LEFT JOIN products p ON wo.product_id = p.id  
            LEFT JOIN contracts c ON wo.contract_id = c.id  
            LEFT JOIN order_work_types owt ON wo.id = owt.order_id  
            GROUP BY wo.id  
        """
        raw_data = self.db.execute_query(query)
        return raw_data
--------------------------------------------------------------------------------
–ü—É—Ç—å: reports\pdf_report.py
–ò–º—è —Ñ–∞–π–ª–∞: pdf_report.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# reports/pdf_report.py
from reportlab.lib.pagesizes import A4
from reportlab.pdfgen import canvas
from reportlab.platypus import Table, TableStyle, Paragraph
from reportlab.lib import colors
from reportlab.lib.styles import getSampleStyleSheet
from db.database import Database
from pathlib import Path
from datetime import datetime


class PDFReportGenerator:
    """–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –æ—Ç—á–µ—Ç–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ PDF."""

    def __init__(self, db: Database) -> None:
        self.db = db
        self._output_dir = Path("reports/pdf")
        self._output_dir.mkdir(exist_ok=True, parents=True)
        self.styles = getSampleStyleSheet()

    def generate(self, filters: dict = None, filename: str = None) -> str:
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF-–æ—Ç—á–µ—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö."""
        try:
            # –ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –∏–∑ –ë–î
            data = self._fetch_data(filters)
            if not data:
                return "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—á–µ—Ç–∞."

            # –°–æ–∑–¥–∞–Ω–∏–µ PDF
            if not filename:
                timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
                filename = f"report_{timestamp}.pdf"

            output_path = self._output_dir / filename
            c = canvas.Canvas(str(output_path), pagesize=A4)

            # –ó–∞–≥–æ–ª–æ–≤–æ–∫
            c.setFont("Helvetica-Bold", 16)
            c.drawString(50, 800, "–û—Ç—á–µ—Ç –ø–æ –Ω–∞—Ä—è–¥–∞–º —Ä–∞–±–æ—Ç")

            # –¢–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
            table = Table(data, colWidths=[100, 80, 120, 100, 80])
            table.setStyle(TableStyle([
                ("BACKGROUND", (0, 0), (-1, 0), colors.grey),
                ("TEXTCOLOR", (0, 0), (-1, 0), colors.whitesmoke),
                ("ALIGN", (0, 0), (-1, -1), "CENTER"),
                ("FONTNAME", (0, 0), (-1, 0), "Helvetica-Bold"),
                ("FONTSIZE", (0, 0), (-1, 0), 12),
                ("BOTTOMPADDING", (0, 0), (-1, 0), 12),
                ("BACKGROUND", (0, 1), (-1, -1), colors.beige),
                ("GRID", (0, 0), (-1, -1), 1, colors.black)
            ]))

            # –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            table.wrapOn(c, 400, 600)
            table.drawOn(c, 50, 650)

            c.save()
            return str(output_path)

        except Exception as e:
            return f"–û—à–∏–±–∫–∞: {str(e)}"

    def _fetch_data(self, filters: dict) -> list:
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á–µ—Ç–∞ —Å —É—á–µ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤."""
        query = """
            SELECT 
                wo.id AS order_id,
                wo.order_date,
                p.name AS product,
                c.contract_code,
                SUM(owt.amount) AS total_amount
            FROM work_orders wo
            LEFT JOIN products p ON wo.product_id = p.id
            LEFT JOIN contracts c ON wo.contract_id = c.id
            LEFT JOIN order_work_types owt ON wo.id = owt.order_id
            GROUP BY wo.id
        """
        raw_data = self.db.execute_query(query)

        # –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
        data = [["–ù–∞—Ä—è–¥ ‚Ññ", "–î–∞—Ç–∞", "–ò–∑–¥–µ–ª–∏–µ", "–ö–æ–Ω—Ç—Ä–∞–∫—Ç", "–°—É–º–º–∞"]]
        for row in raw_data:
            data.append([str(item) for item in row])

        return data
--------------------------------------------------------------------------------
–ü—É—Ç—å: tests\test_database.py
–ò–º—è —Ñ–∞–π–ª–∞: test_database.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
import pytest
from pathlib import Path
from db.database import Database
from db.backup import BackupManager

TEST_DB_PATH = "test_work_orders.db"


@pytest.fixture(scope="function")
def test_db():
    """–§–∏–∫—Å—Ç—É—Ä–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —Ç–µ—Å—Ç–æ–º."""
    db = Database()
    db.db_path = TEST_DB_PATH  # –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –¥–ª—è —Ç–µ—Å—Ç–æ–≤

    # –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã
    db.execute_query("""
        CREATE TABLE IF NOT EXISTS employees (
            id INTEGER PRIMARY KEY,
            employee_id TEXT UNIQUE NOT NULL,
            full_name TEXT NOT NULL,
            workshop_number INTEGER NOT NULL,
            position TEXT NOT NULL
        )
    """)
    yield db
    # –£–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –ë–î –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
    Path(TEST_DB_PATH).unlink(missing_ok=True)


def test_create_tables(test_db):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü."""
    test_db.execute_query(
        "INSERT INTO employees (employee_id, full_name, workshop_number, position) VALUES (?, ?, ?, ?)",
        ("001", "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω", 1, "–ò–Ω–∂–µ–Ω–µ—Ä")
    )
    result = test_db.execute_query("SELECT * FROM employees")
    assert len(result) == 1, "–î–∞–Ω–Ω—ã–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ —Ç–∞–±–ª–∏—Ü—É."


def test_backup_manager(test_db):
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω—ã—Ö –∫–æ–ø–∏–π."""
    # –Ø–≤–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ë–î
    assert Path(TEST_DB_PATH).exists(), "–¢–µ—Å—Ç–æ–≤–∞—è –ë–î –Ω–µ —Å–æ–∑–¥–∞–Ω–∞!"

    manager = BackupManager(TEST_DB_PATH, backup_dir="test_backups", max_backups=2)
    backup_path = manager.create_backup()

    assert backup_path is not None, "–†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è –Ω–µ —Å–æ–∑–¥–∞–Ω–∞."
    assert Path(backup_path).exists(), "–§–∞–π–ª —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç."

    # –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    for file in Path("test_backups").glob("*.db"):
        file.unlink()
    Path("test_backups").rmdir()
--------------------------------------------------------------------------------
–ü—É—Ç—å: utils\validators.py
–ò–º—è —Ñ–∞–π–ª–∞: validators.py
–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:
# utils/validators.py
from datetime import datetime
from db.database import Database
from typing import Optional


def validate_date(date_str: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞—Ç—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ DD.MM.YYYY."""
    try:
        datetime.strptime(date_str, "%d.%m.%Y")
        return True
    except ValueError:
        return False


def validate_positive_integer(value: str) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ —è–≤–ª—è–µ—Ç—Å—è –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —Ü–µ–ª—ã–º —á–∏—Å–ª–æ–º."""
    try:
        number = int(value)
        return number > 0
    except ValueError:
        return False


def validate_unique_contract_code(code: str, db: Database) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —à–∏—Ñ—Ä–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞."""
    result = db.execute_query(
        "SELECT COUNT(*) FROM contracts WHERE contract_code = ?", (code,)
    )
    return result[0][0] == 0 if result else False


def validate_unique_work_type_name(name: str, db: Database) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –Ω–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –≤–∏–¥–∞ —Ä–∞–±–æ—Ç."""
    result = db.execute_query(
        "SELECT COUNT(*) FROM work_types WHERE name = ?", (name,)
    )
    return result[0][0] == 0 if result else False


def validate_order_data(
        date: str, workers: list, works: list, db: Database
) -> tuple[bool, Optional[str]]:
    """–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞—Ä—è–¥–∞. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (—É—Å–ø–µ—Ö, —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ)."""
    errors = []

    if not validate_date(date):
        errors.append("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì")

    if not workers:
        errors.append("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ")

    for work in works:
        if not validate_positive_integer(str(work["quantity"])):
            errors.append("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞–±–æ—Ç –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º")

    if errors:
        return (False, "\n".join(errors))
    return (True, None)


def validate_unique_employee_id(employee_id: str, db: Database) -> bool:
    """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ç–∞–±–µ–ª—å–Ω–æ–≥–æ –Ω–æ–º–µ—Ä–∞."""
    result = db.execute_query(
        "SELECT COUNT(*) FROM employees WHERE employee_id = ?", (employee_id,)
    )
    return result[0][0] == 0 if result else False

--------------------------------------------------------------------------------
